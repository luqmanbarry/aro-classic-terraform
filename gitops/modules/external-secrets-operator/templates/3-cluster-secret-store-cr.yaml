---
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: "{{ .Values.keyVaultName | lower }}"
  annotations:
    managed-by: argocd.argoproj.io
    argocd.argoproj.io/sync-wave: "3"
    argocd.argoproj.io/sync-options: "SkipDryRunOnMissingResource=true"
spec:
  provider:
    azurekv:
      tenantId: {{ .Values.provider.azurekv.tenantID }}
      vaultUrl: {{ .Values.provider.azurekv.vaultURL }}
      authSecretRef:
        clientId:
          name: {{ .Values.cluster_sp_k8s_secret_name }}
          namespace: {{ .Values.tf_resources_namespace }}
          key: client_id
        clientSecret:
          name: {{ .Values.cluster_sp_k8s_secret_name }}
          namespace: {{ .Values.tf_resources_namespace }}
          key: client_secret